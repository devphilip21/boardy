!function(n){var o={};function r(e){if(o[e])return o[e].exports;var t=o[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,r),t.l=!0,t.exports}r.m=n,r.c=o,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}n.r(t);var o=function(){function o(){var e,t,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),n=void 0,(t="handlers")in(e=this)?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,this.handlers=[]}var e,t,n;return e=o,(t=[{key:"on",value:function(e){this.handlers.push(e)}},{key:"off",value:function(e){var t=this.handlers.indexOf(e);-1!==t&&this.handlers.splice(t,1)}},{key:"offAll",value:function(){this.handlers=[]}},{key:"emit",value:function(t){this.handlers.forEach(function(e){return e(t)})}}])&&r(e.prototype,t),n&&r(e,n),o}();function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var a,u,c=function(){function o(){var e,t,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),n=void 0,(t="id")in(e=this)?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,this.id=0}var e,t,n;return e=o,n=[{key:"hashStringToNumber",value:function(e){for(var t=0,n=0;n<e.length;n++)t=Math.imul(31,t)+e.charCodeAt(n)|0;return Math.abs(t)}}],(t=[{key:"get",value:function(){return++this.id}}])&&i(e.prototype,t),n&&i(e,n),o}();(u=a=a||{})[u.MouseDown=0]="MouseDown",u[u.MouseDownAndMove=1]="MouseDownAndMove",u[u.MouseUp=2]="MouseUp",u[u.MouseOut=3]="MouseOut",u[u.MouseMove=4]="MouseMove";function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function v(i){var a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t,n,o,r=d(i);return t=a?(e=d(this).constructor,Reflect.construct(r,arguments,e)):r.apply(this,arguments),n=this,!(o=t)||"object"!==s(o)&&"function"!=typeof o?h(n):o}}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var b=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(i,o);var e,t,n,r=v(i);function i(e){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),p(h(o=r.call(this)),"context",void 0),p(h(o),"currentToolId",void 0),p(h(o),"isMouseDown",void 0),p(h(o),"toolId",void 0),p(h(o),"handleCommon",function(t){return function(e){o.currentToolId!==o.toolId.behavior&&t(e)}}),p(h(o),"handleMouseDown",o.handleCommon(function(e){var t=o.createMouseAction(e,a.MouseDown);o.emit(t),o.isMouseDown=!0})),p(h(o),"handleMouseUp",o.handleCommon(function(e){var t=o.createMouseAction(e,a.MouseUp);o.emit(t),o.isMouseDown=!1})),p(h(o),"handleMouseOut",o.handleCommon(function(e){var t=o.createMouseAction(e,a.MouseOut);o.emit(t),o.isMouseDown=!1})),p(h(o),"handleMouseMove",o.handleCommon(function(e){var t=o.isMouseDown?a.MouseDownAndMove:a.MouseMove,n=o.createMouseAction(e,t);o.emit(n)})),o.toolId={behavior:c.hashStringToNumber("behavior")},o.context=e,o.currentToolId=o.toolId.behavior,o.addCanvasEventListeners(),o.isMouseDown=!1,o}return e=i,(t=[{key:"setTool",value:function(e){this.toolId[e]||(this.toolId[e]=c.hashStringToNumber(e)),this.currentToolId=this.toolId[e]}},{key:"destroy",value:function(){this.removeCanvasEventListeners()}},{key:"addCanvasEventListeners",value:function(){var e=this.context.canvas.screen;e.addEventListener("mousedown",this.handleMouseDown),e.addEventListener("mouseup",this.handleMouseUp),e.addEventListener("mouseout",this.handleMouseOut),e.addEventListener("mousemove",this.handleMouseMove)}},{key:"removeCanvasEventListeners",value:function(){var e=this.context.canvas.screen;e.removeEventListener("mousedown",this.handleMouseDown),e.removeEventListener("mouseup",this.handleMouseUp),e.removeEventListener("mouseout",this.handleMouseOut),e.removeEventListener("mousemove",this.handleMouseMove)}},{key:"createMouseAction",value:function(e,t){var n=Uint32Array?new Uint32Array(5):[];return n[0]=t,n[1]=e.offsetX*this.context.unit,n[2]=e.offsetY*this.context.unit,n[3]=this.context.unit,n[4]=this.currentToolId,n}}])&&l(e.prototype,t),n&&l(e,n),i}();function y(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var w=function(){function o(e,t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),m(this,"painter",void 0),m(this,"rasterizer",void 0),m(this,"actionQueue",void 0),m(this,"flag",void 0),m(this,"animate",function(){n.actionQueue.forEach(function(e){return n.painter.paint(e)}),n.actionQueue=[],n.rasterizer.rasterize(),n.flag&&window.requestAnimationFrame(n.animate)}),this.painter=e,this.rasterizer=t,this.actionQueue=[],this.flag=!1,this.startLoop()}var e,t,n;return e=o,(t=[{key:"render",value:function(e){this.actionQueue.push(e)}},{key:"startLoop",value:function(){this.flag=!0,window.requestAnimationFrame(this.animate)}},{key:"stopLoop",value:function(){this.flag=!1}}])&&y(e.prototype,t),n&&y(e,n),o}();function g(t,e){var n,o=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),o.push.apply(o,n)),o}function M(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function O(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var k,P=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),O(this,"drawingMap",void 0),this.drawingMap=e||{}}var e,n,o;return e=t,o=[{key:"create",value:function(e){return new t(e)}},{key:"extend",value:function(r,e){var i=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?g(Object(n),!0).forEach(function(e){O(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}({},e);return r.getActionTypes().forEach(function(e){var t=r.get(e),n=i[e],o=n?function(){t.apply(void 0,arguments),n.apply(void 0,arguments)}:t;i[e]=o}),new t(i)}}],(n=[{key:"set",value:function(e,t){this.drawingMap[e]=t}},{key:"get",value:function(e){return this.drawingMap[e]}},{key:"getActionTypes",value:function(){var e=Object.keys(this.drawingMap),n=[];return e.forEach(function(e){var t=Number.parseInt(e,10);Number.isNaN(t)||n.push(t)}),n}}])&&M(e.prototype,n),o&&M(e,o),t}();function x(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var j,T=P.create((x(k={},a.MouseDown,function(e,t,n,o){e.beginPath(),e.moveTo(t,n),e.lineJoin="round",e.lineWidth=+o,e.strokeStyle="#000"}),x(k,a.MouseDownAndMove,function(e,t,n){e.lineTo(t,n),e.stroke()}),x(k,a.MouseUp,function(e){e.closePath()}),x(k,a.MouseOut,function(e){e.closePath()}),k));function E(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var C=P.create((E(j={},a.MouseDown,function(e){e.globalCompositeOperation="destination-out"}),E(j,a.MouseDownAndMove,function(e,t,n,o){e.beginPath(),e.arc(t,n,10*o,0,2*Math.PI,!1),e.fill(),e.closePath()}),E(j,a.MouseOut,function(e){e.globalCompositeOperation="source-over"}),E(j,a.MouseUp,function(e){e.globalCompositeOperation="source-over"}),j));function D(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function S(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var A=function(){function n(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),S(this,"tools",void 0),S(this,"context",void 0),this.context=e,this.context.ctx.offscreen.globalCompositeOperation="source-over",this.tools=(S(t={},c.hashStringToNumber("blackline"),T),S(t,c.hashStringToNumber("eraser"),C),t)}var e,t,o;return e=n,(t=[{key:"paint",value:function(e){var t=e[0],n=e[1],o=e[2],r=e[3],i=e[4],a=this.tools[i]&&this.tools[i].get(t);a&&a(this.context.ctx.offscreen,n,o,r)}},{key:"addTool",value:function(e,t){var n=c.hashStringToNumber(e);this.tools[n]=t}}])&&D(e.prototype,t),o&&D(e,o),n}();function L(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var I=function(){function r(e){var t,n,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),o=void 0,(n="context")in(t=this)?Object.defineProperty(t,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[n]=o,this.context=e}var e,t,n;return e=r,(t=[{key:"rasterize",value:function(){this.context.ctx.screen.clearRect(0,0,this.context.resolution[0],this.context.resolution[1]),this.context.ctx.screen.drawImage(this.context.canvas.offscreen,0,0,this.context.resolution[0],this.context.resolution[1],0,0,this.context.size[0],this.context.size[1])}}])&&L(e.prototype,t),n&&L(e,n),r}();function _(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function U(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var z,N=function(){function t(e){if(!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),U(this,"context",void 0),U(this,"painter",void 0),U(this,"renderer",void 0),U(this,"trigger",void 0),!e.canvas)throw new Error("canvas element is required!");this.context=this.initalizeContext(e),this.painter=e.painter||new A(this.context),this.renderer=new w(this.painter,new I(this.context)),this.trigger=new b(this.context)}var e,n,o;return e=t,(n=[{key:"on",value:function(e){this.trigger.on(e)}},{key:"render",value:function(e){this.renderer.render(e)}},{key:"addTool",value:function(e,t){this.painter.addTool(e,t)}},{key:"useTool",value:function(e){this.trigger.setTool(e)}},{key:"initalizeContext",value:function(e){var t=e.canvas,n=document.createElement("canvas"),o=[t.offsetWidth,t.offsetHeight],r=this.initializeResolution(e,o),i=this.calculateUnit(o,r);return n.width=r[0],n.height=r[1],{canvas:{screen:t,offscreen:n},ctx:{screen:t.getContext("2d"),offscreen:n.getContext("2d")},size:o,resolution:r,unit:i}}},{key:"initializeResolution",value:function(e,t){var n=[0,0];return e.resolution?(n[0]=e.resolution.width||e.resolution.height/t[1]*t[0],n[1]=e.resolution.height||e.resolution.width/t[0]*t[1]):(n[0]=2048,n[1]=n[0]/t[0]*t[1]),n}},{key:"calculateUnit",value:function(e,t){return e[0]>e[1]?t[1]/e[1]:t[0]/e[0]}}])&&_(e.prototype,n),o&&_(e,o),t}();function R(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}U(N,"Tool",P),U(N,"ActionType",a);var q,Q={send:function(e){q(e)},on:function(e){q=e}},W=new N({canvas:document.querySelector("#canvas-leader")});W.useTool("blackline"),W.on(function(e){W.render(e),Q.send(e)});var F=new N({canvas:document.querySelector("#canvas-member-1")}),J=new N({canvas:document.querySelector("#canvas-member-2")});Q.on(function(e){F.render(e),J.render(e)});var H="#000",X=N.Tool.create((R(z={},a.MouseDown,function(e,t,n,o){e.beginPath(),e.moveTo(t,n),e.lineJoin="round",e.lineWidth=2*o,e.strokeStyle=H}),R(z,a.MouseDownAndMove,function(e,t,n){e.lineTo(t,n),e.stroke()}),R(z,a.MouseUp,function(e){e.closePath()}),R(z,a.MouseOut,function(e){e.closePath()}),z)),Y="globalColorLine";W.addTool(Y,X),F.addTool(Y,X),J.addTool(Y,X),K(Y);var B=[document.querySelector("#inp-pen"),document.querySelector("#btn-eraser")];function G(n){B.forEach(function(e,t){t===n?e.parentElement.classList.add("is-selected"):e.parentElement.classList.remove("is-selected")})}function K(e){W.useTool(e),F.useTool(e),J.useTool(e)}G(0),B[0].addEventListener("input",function(e){H=e.target.value,K(Y),G(0)}),B[1].addEventListener("click",function(e){K("eraser"),G(1)})}]);