!function(n){var r={};function o(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,o),t.l=!0,t.exports}o.m=n,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(n,r,function(e){return t[e]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=0)}([function(e,t,n){"use strict";function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.r(t);var r=function(){function r(){var e,t,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),n=void 0,(t="handlers")in(e=this)?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,this.handlers=[]}var e,t,n;return e=r,(t=[{key:"on",value:function(e){this.handlers.push(e)}},{key:"off",value:function(e){var t=this.handlers.indexOf(e);-1!==t&&this.handlers.splice(t,1)}},{key:"offAll",value:function(){this.handlers=[]}},{key:"emit",value:function(t){this.handlers.forEach(function(e){return e(t)})}}])&&o(e.prototype,t),n&&o(e,n),r}();function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=function(){function r(){var e,t,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),n=void 0,(t="id")in(e=this)?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,this.id=0}var e,t,n;return e=r,n=[{key:"hashStringToNumber",value:function(e){for(var t=0,n=0;n<e.length;n++)t=Math.imul(31,t)+e.charCodeAt(n)|0;return Math.abs(t)}}],(t=[{key:"get",value:function(){return++this.id}}])&&i(e.prototype,t),n&&i(e,n),r}();function c(e){return function(e){if(Array.isArray(e))return u(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var s=function(r,o){if(!o)return r;function i(){clearTimeout(u),u=0,r.apply(void 0,c(a))}var a,u=0;return function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];a=t,u||(u=window.setTimeout(i,o),r.apply(void 0,c(a)))}};function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(i){var a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t,n,r,o=p(i);return t=a?(e=p(this).constructor,Reflect.construct(o,arguments,e)):o.apply(this,arguments),n=this,!(r=t)||"object"!==l(r)&&"function"!=typeof r?v(n):r}}function v(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var g,y,A=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(i,r);var e,t,n,o=d(i);function i(e,t){var n,r=t.debounceTime;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),b(v(n=o.call(this)),"element",void 0),b(v(n),"handleResize",function(){var e=n.element.offsetWidth,t=n.element.offsetHeight;n.emit({width:e,height:t})}),n.handleResize=s(n.handleResize,r),n.element=e,window.addEventListener("resize",n.handleResize),n}return e=i,(t=[{key:"destroy",value:function(){window.removeEventListener("resize",this.handleResize)}}])&&f(e.prototype,t),n&&f(e,n),i}();(y=g=g||{})[y.MouseDown=0]="MouseDown",y[y.MouseUp=1]="MouseUp",y[y.MouseIn=2]="MouseIn",y[y.MouseOut=3]="MouseOut",y[y.MouseMove=4]="MouseMove",y[y.Drag=5]="Drag",y[y.DragIn=6]="DragIn",y[y.DragOut=7]="DragOut";function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function w(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function O(e,t){return(O=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function j(i){var a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t,n,r,o=E(i);return t=a?(e=E(this).constructor,Reflect.construct(o,arguments,e)):o.apply(this,arguments),n=this,!(r=t)||"object"!==m(r)&&"function"!=typeof r?x(n):r}}function x(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function E(e){return(E=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function I(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var k=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&O(e,t)}(i,r);var e,t,n,o=j(i);function i(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),I(x(r=o.call(this)),"context",void 0),I(x(r),"currentToolId",void 0),I(x(r),"isMouseDown",void 0),I(x(r),"toolId",void 0),I(x(r),"handleCommon",function(t){return function(e){r.currentToolId!==r.toolId.behavior&&t(e)}}),I(x(r),"handleMouseIn",r.handleCommon(function(e){var t=r.isMouseDown?g.DragIn:g.MouseIn,n=r.createAction(e.offsetX,e.offsetY,t);r.emit(n)})),I(x(r),"handleMouseOut",r.handleCommon(function(e){var t=r.isMouseDown?g.DragOut:g.MouseOut,n=r.createAction(e.offsetX,e.offsetY,t);r.emit(n)})),I(x(r),"handleMouseMove",r.handleCommon(function(e){var t=r.isMouseDown?g.Drag:g.MouseMove,n=r.createAction(e.offsetX,e.offsetY,t);r.emit(n)})),I(x(r),"handleMouseDownOnWindow",r.handleCommon(function(e){var t,n;r.isMouseDown=!0,e.target===r.context.canvas.screen&&(t=g.MouseDown,n=r.createAction(e.offsetX,e.offsetY,t),r.emit(n))})),I(x(r),"handleMouseUpOnWindow",r.handleCommon(function(e){var t,n;r.isMouseDown=!1,e.target===r.context.canvas.screen&&(t=g.MouseUp,n=r.createAction(e.offsetX,e.offsetY,t),r.emit(n))})),r.toolId={behavior:a.hashStringToNumber("behavior")},r.context=e,r.currentToolId=r.toolId.behavior,r.addDocumentEventListeners(),r.isMouseDown=!1,r}return e=i,(t=[{key:"setTool",value:function(e){this.toolId[e]||(this.toolId[e]=a.hashStringToNumber(e)),this.currentToolId=this.toolId[e]}},{key:"destroy",value:function(){this.removeDocumentEventListeners()}},{key:"addDocumentEventListeners",value:function(){var e=this.context.canvas.screen;e.addEventListener("mouseover",this.handleMouseIn),e.addEventListener("mouseout",this.handleMouseOut),e.addEventListener("mousemove",this.handleMouseMove),window.addEventListener("mousedown",this.handleMouseDownOnWindow),window.addEventListener("mouseup",this.handleMouseUpOnWindow)}},{key:"removeDocumentEventListeners",value:function(){var e=this.context.canvas.screen;e.removeEventListener("mouseover",this.handleMouseIn),e.removeEventListener("mouseout",this.handleMouseOut),e.removeEventListener("mousemove",this.handleMouseMove),window.removeEventListener("mousedown",this.handleMouseDownOnWindow),window.removeEventListener("mouseup",this.handleMouseUpOnWindow)}},{key:"createAction",value:function(e,t,n){var r=Uint32Array?new Uint32Array(5):[];return r[0]=n,r[1]=this.checkPointXOverflow(e)*this.context.unit.width,r[2]=this.checkPointYOverflow(t)*this.context.unit.height,r[3]=this.context.unit.contents,r[4]=this.currentToolId,r}},{key:"checkPointXOverflow",value:function(e){return e<0?e=0:e>this.context.size.width&&(e=this.context.size.width),e}},{key:"checkPointYOverflow",value:function(e){return e<0?e=0:e>this.context.size.height&&(e=this.context.size.height),e}}])&&w(e.prototype,t),n&&w(e,n),i}();function M(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function S(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var C=function(){function r(e,t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),S(this,"painter",void 0),S(this,"rasterizer",void 0),S(this,"actionQueue",void 0),S(this,"isRunning",void 0),S(this,"animate",function(){if(0!==n.actionQueue.length){for(;0<n.actionQueue.length;){var e=n.actionQueue.pop();e&&n.painter.paint(e)}n.rasterizer.rasterize(),window.requestAnimationFrame(n.animate)}else n.isRunning=!1}),this.painter=e,this.rasterizer=t,this.actionQueue=[],this.isRunning=!1}var e,t,n;return e=r,(t=[{key:"render",value:function(e){this.actionQueue.unshift(e),this.isRunning||window.requestAnimationFrame(this.animate)}}])&&M(e.prototype,t),n&&M(e,n),r}();function P(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function T(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function R(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var z,D=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),R(this,"drawingMap",void 0),this.drawingMap=e||{}}var e,n,r;return e=t,r=[{key:"create",value:function(e){return new t(e)}},{key:"extend",value:function(o,e){var i=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?P(Object(n),!0).forEach(function(e){R(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):P(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}({},e);return o.getActionTypes().forEach(function(e){var t=o.get(e),n=i[e],r=n?function(){t.apply(void 0,arguments),n.apply(void 0,arguments)}:t;i[e]=r}),new t(i)}}],(n=[{key:"set",value:function(e,t){this.drawingMap[e]=t}},{key:"get",value:function(e){return this.drawingMap[e]}},{key:"getActionTypes",value:function(){var e=Object.keys(this.drawingMap),n=[];return e.forEach(function(e){var t=Number.parseInt(e,10);Number.isNaN(t)||n.push(t)}),n}}])&&T(e.prototype,n),r&&T(e,r),t}();function G(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function W(e,t){var n=t.pointX,r=t.pointY,o=t.unit;e.beginPath(),e.moveTo(n,r),e.lineJoin="round",e.lineWidth=+o,e.strokeStyle="#000"}function q(e,t){var n=t.pointX,r=t.pointY;e.lineTo(n,r),e.stroke()}function N(e,t){q(e,t),e.closePath()}var Q,L=D.create((G(z={},g.MouseDown,W),G(z,g.DragIn,W),G(z,g.Drag,q),G(z,g.DragOut,N),G(z,g.MouseUp,N),z)),U=34,B=34,X="data:image/png;base64,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";function Z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function J(e,t){var n=t.unit,r=function(e){if(K[e])return K[e];var t=document.createElement("canvas"),n=t.getContext("2d"),r=U*e,o=B*e;return t.width=r,t.height=o,n.drawImage(V,0,0,V.width,V.height,0,0,r,o),K[e]=t}(n);e.strokeStyle=e.createPattern(r,"repeat"),e.lineCap="round",e.lineWidth=10*n}var Y,F,V=((Y=document.createElement("img")).width=U,Y.height=B,Y.src=X,Y),K={},H=D.extend(L,(Z(Q={},g.MouseDown,J),Z(Q,g.DragIn,J),Q));function _(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var $=D.create((_(F={},g.MouseDown,function(e){e.globalCompositeOperation="destination-out"}),_(F,g.Drag,function(e,t){var n=t.pointX,r=t.pointY,o=t.unit;e.beginPath(),e.arc(n,r,20*o,0,2*Math.PI,!1),e.fill(),e.closePath()}),_(F,g.MouseOut,function(e){e.globalCompositeOperation="source-over"}),_(F,g.MouseUp,function(e){e.globalCompositeOperation="source-over"}),F));function ee(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function te(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ne=function(){function n(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),te(this,"tools",void 0),te(this,"context",void 0),this.context=e,this.context.ctx.offscreen.globalCompositeOperation="source-over",this.tools=(te(t={},a.hashStringToNumber("blackline"),L),te(t,a.hashStringToNumber("blackcrayon"),H),te(t,a.hashStringToNumber("eraser"),$),t)}var e,t,r;return e=n,(t=[{key:"paint",value:function(e){var t=e[0],n=e[1],r=e[2],o=e[3],i=e[4],a=this.tools[i]&&this.tools[i].get(t);a&&a(this.context.ctx.offscreen,{pointX:n,pointY:r,unit:o})}},{key:"addTool",value:function(e,t){var n=a.hashStringToNumber(e);this.tools[n]=t}}])&&ee(e.prototype,t),r&&ee(e,r),n}();function re(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var oe=function(){function o(e){var t,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),r=void 0,(n="context")in(t=this)?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,this.context=e}var e,t,n;return e=o,(t=[{key:"rasterize",value:function(){this.clear(),this.context.ctx.screen.drawImage(this.context.canvas.offscreen,0,0,this.context.resolution.width,this.context.resolution.height,0,0,this.context.size.width,this.context.size.height)}},{key:"clear",value:function(){this.context.ctx.screen.clearRect(0,0,this.context.resolution.width,this.context.resolution.height)}}])&&re(e.prototype,t),n&&re(e,n),o}();function ie(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ae(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ue=function(){function t(e){var o=this;if(!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),ae(this,"context",void 0),ae(this,"painter",void 0),ae(this,"renderer",void 0),ae(this,"trigger",void 0),ae(this,"resizeObserver",void 0),ae(this,"handleResize",function(e){var t=e.width,n=e.height,r=o.calculateUnit({width:t,height:n},o.context.resolution);o.context.size.width=t,o.context.size.height=n,o.context.canvas.screen.width=t,o.context.canvas.screen.height=n,o.context.unit.width=r.width,o.context.unit.height=r.height,o.renderer.render(null)}),!e.canvas)throw new Error("canvas element is required!");this.context=this.initalizeContext(e),this.painter=e.painter||new ne(this.context),this.renderer=new C(this.painter,new oe(this.context)),this.trigger=new k(this.context),this.resizeObserver=new A(this.context.canvas.screen,{debounceTime:300}),this.resizeObserver.on(this.handleResize)}var e,n,r;return e=t,(n=[{key:"on",value:function(e){this.trigger.on(e)}},{key:"render",value:function(e){this.renderer.render(e)}},{key:"addTool",value:function(e,t){this.painter.addTool(e,t)}},{key:"useTool",value:function(e){this.trigger.setTool(e)}},{key:"initalizeContext",value:function(e){var t=e.canvas,n=document.createElement("canvas"),r=this.intializeSize(e),o=this.initializeResolution(e,r),i=this.calculateUnit(r,o);return t.width=r.width,t.height=r.height,n.width=o.width,n.height=o.height,{canvas:{screen:t,offscreen:n},ctx:{screen:t.getContext("2d"),offscreen:n.getContext("2d")},size:r,resolution:o,unit:i}}},{key:"intializeSize",value:function(e){var t;return null!==(t=e.canvas)&&void 0!==t&&t.offsetWidth?{width:e.canvas.offsetWidth,height:e.canvas.offsetHeight}:{width:500,height:500}}},{key:"initializeResolution",value:function(e,t){var n={width:0,height:0};return e.resolution?(n.width=e.resolution.width||e.resolution.height/t.height*t.width,n.height=e.resolution.height||e.resolution.width/t.width*t.height):(n.width=2048,n.height=n.width/t.width*t.height),n}},{key:"calculateUnit",value:function(e,t){var n={width:0,height:0,contents:0};return n.width=t.width/e.width,n.height=t.height/e.height,n.contents=e.width>e.height?n.height:n.width,n}}])&&ie(e.prototype,n),r&&ie(e,r),t}();ae(ue,"Tool",D),ae(ue,"ActionType",g);var ce,se={send:function(e){ce(e)},on:function(e){ce=e}},le=new ue({canvas:document.querySelector("#leader-canvas")});le.useTool("blackline"),le.on(function(e){le.render(e),se.send(e)});var fe=new ue({canvas:document.querySelector("#member-canvas-1")}),he=new ue({canvas:document.querySelector("#member-canvas-2")});se.on(function(e){fe.render(e),he.render(e)})}]);